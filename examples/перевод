<?в PHP
/**
* ПАРАМЕТРЫ КОНФИГУРАЦИИ
* Этот скрипт должен вы иметь whatsapp и пароль, прежде чем использовать его. Если вы
* не у вашего whatsapp пароль этот скрипт не имеет смысла.
*
* НЕ ИЩИ ПОМОЧЬ С ЭТИМ СКРИПТОМ, ЕСЛИ ВЫ НЕ ИМЕЕТЕ ВАШЕГО WHATSAPP ПАРОЛЬ!!!
*
* Использовать пример ниже чтобы добавить свои собственные настройки конфигурации.
*
* (Я упоминал, что вы должны уже знать пароль в whatsapp?)
*
* Пользователи Gmail:
* Если у вас есть учетная запись электронной почты Google и вы *добавлены номера мобильных телефонов* для вашего
 * в Gmail контакты данный скрипт может получить доступ к этим контактам, и добавить их в выпадающем списке
* для вас легко выбирать, когда вы хотите, чтобы текст кого-то.
*
* Цифры должны быть помечены как мобильные и должен быть в международном формате.
*
* Просто абсолютно понятно - при наличии контактов в Gmail, перечисленные в этом скрипте, не означает, что
* что человек имеет whatsapp, который установлен. Вы должны знать, если они могут принимать сообщения whatsapp прежде чем
* вы попробуйте отправить им сообщения.
*
* У большинства моих друзей в whatsapp, так я знаю, что я могу выбрать практически любой из моих контактов Google.
*
 * Если Вы не хотите, чтобы имеют эту функцию, то не добавляйте электронной почты и линии электронной почты пароль
* конфиг.
*
*
* Вы можете добавить столько конфигурации блоков, как вы хотите. Пока каждого нового пользователя в whatsapp пароль уже....
*
* Наслаждайтесь.
*/
//Это простой пароль для просмотра этого скрипта. Это не в whatsapp паролем.
$конфигурации['webpassword'] = 'MakeUpPassword';

Шаблон //Конфиг
//$конфигурации['YourFirstName'] = массив(
fromNumber / / '' = > '<Ваш номер мобильного телефона например: 44123456789>',
// 'Ника' => '<псевдоним телефона>',
// 'waPassword' => "<Ваш whatsapp паролем. Полученных при регистрации с помощью этого API или с помощью Missvenom нюхать с телефона.>"
//
//Необязательно
// 'электронной почты' => 'testemail@gmail.com',
// 'emailPassword' => 'gmailpassword'
//
//);
//
//
//Пример
//$конфигурации['Джонатан'] = массив(
fromNumber / / '' = > '441234567890',
// 'Ника' => "для iPhone Джонатана",
// 'waPassword' => "EsdfsawS+/ffdskjsdhwebdgxbs=",
// 'электронной почты' => 'testemail@gmail.com',
// 'emailPassword' => 'gmailpassword'
//);

$конфигурации['поле'] = [
'fromNumber' => '441234567890',
 'Ника' => 'YOURNICKNAME',
'waPassword' => 'EsdfsawS+/ffdskjsdhwebdgxbs=',
'электронной почты' => 'testemail@gmail.com',
'emailPassword' => 'gmailpassword',
];

/**
* НИЧЕГО ИЗМЕНИТЬ НИЖЕ ЭТОЙ ЛИНИИ.
*/
требуется '../src/whatsprot.class.php';

/**
* На будущее, другие способы получения контактов из различных источников
* может быть использован путем осуществления контактов Интерфейс.
*
*
* Данные должны быть возвращены в массив, который выглядит следующим образом:
*
* Массив
*
* (
* [0] => массив
* (
* [название] => PersonName
* [идентификатор] => 1234567890
* )
*
 * [1] => массив
* (
* [название] => PersonName2
* [идентификатор] => 0987654321
* )
* )
*/
Контакты интерфейс
{
getContacts государственной функции(массив $config, то $пользователей);
}

/**
* Осуществление контактов Google.
*/
GoogleContacts класс реализует Контакты
{
Частная $конфиг;
Частная $завиток;
Частная $авт;
Частная $заголовки;

общественная функция __конструкт()
{
$этом->скручиваемость = curl_init();
}

getContacts государственной функции(массив $config, то $пользователей)
{
если (!array_key_exists($пользователь $конфиг)) {
 бросить новое исключение (нет полномочий для запрошенного пользователя.');
} еще {
$этом->конфигурация = $config;в
$контакты = $этом->getGoogleContacts($пользователю);
}
если (is_array($контакты)) {
возвращение $контакты;
}

возвращает false;
}

Частная getGoogleContacts функция($пользователю)
{
если (!использования isset($этом->конфиг[$пользователя]['электронной почты'])) {
бросить новое исключение("адрес электронной почты для пользователя $user не была поставлена или установлен.");
}

попробовать {
$двиг = $этом->getAuthString($пользователю);
$этом->setHeaders($авт);
$группы = $этом->getGoogleGroupId (система Группа: моих контактов);
$контакты = $этом->retreiveContacts($идентификатор_группы);
} поймать (исключение $д) {
выкинуть $е;
}

возвращение $контакты;
}

Частная getAuthString функция($пользователю)
{
// Построить http-запрос Post
$clientlogin_url = 'https://www.google.com/accounts/ClientLogin';
$clientlogin_post = [
'accounttype, начиная' => 'HOSTED_OR_GOOGLE',
'Электронной почты' => $этом->конфиг[$пользователя]['электронной почты'],
 'Пароль' => $этом->конфиг[$пользователя]['emailPassword'],
'уборка' => 'Ср',
'источник' = > приложение "whatsapp",
];

// Установить некоторые параметры (некоторые для SHTTP)
curl_setopt($этом->скручиваемость, CURLOPT_URL, $clientlogin_url);
curl_setopt($этом->скручиваемость, CURLOPT_POST, True);в
curl_setopt($этом->скручиваемость, CURLOPT_POSTFIELDS, $clientlogin_post);
curl_setopt($этом->скручиваемость, CURLOPT_HTTPAUTH, CURLAUTH_ANY);
curl_setopt($этом->скручиваемость, параметра curlopt_ssl_verifypeer, ложь);
curl_setopt($этом->скручиваемость, CURLOPT_RETURNTRANSFER, 1);

 // Выполнение
$authresponse = curl_exec($этом->завиток);

// Получаем авт строку и сохранить его
$играм = нуль;
$рез = функция preg_match('/авт=([а-з0-9_-]+)/я', $authresponse, $играм);
если ($рез == 1) {
$этом->двиг = $соответствует[1];

возврат $соответствует[1];
}
бросить новое исключение('не удается получить код проверки подлинности от Google');
}

Частная setHeaders функция($двиг)
{
$этом->заголовки = [
Авторизация: GoogleLogin авт='.$двиг,
'Антивируса Avast-Версия: 2.0',
];
}

 Частная функция getHeaders()
{
вернуть $это->заголовки;
}

Частная getGoogleGroupId функция($имя_группы)
{
// Подключение к Google и получаем список всех контактных групп.
curl_setopt($этом->скручиваемость, CURLOPT_URL, 'https://www.google.com/m8/feeds/groups/default/full');
curl_setopt($этом->скручиваемость, CURLOPT_HTTPHEADER, $этом->getHeaders());
curl_setopt($этом->скручиваемость, CURLOPT_POST, ложь);
curl_setopt($этом->скручиваемость, CURLOPT_RETURNTRANSFER, True);в

$groupresponse = curl_exec($этом->завиток);

//Загрузка XML-ответ
 $атом = simplexml_load_string($groupresponse);

//Поиск идентификатора группы для основной контактной группы.
по каждому элементу ($атом->запись как $вход) {
если (stristr($запись->название, $имя_группы) !== значение false) {
$группы контактов = $запись->идентификатор;
}
}

если (использования isset($группы контактов)) {
возврат $группы контактов;
} еще {
возвращает false;
}
}

Частная retreiveContacts функция($идентификатор_группы)
{
 curl_setopt($этом->скручиваемость, CURLOPT_URL, "https://www.google.com/m8/feeds/contacts/default/full?max-results=2000&group=$идентификатор_группы");
curl_setopt($этом->скручиваемость, CURLOPT_HTTPHEADER, $этом->getHeaders());
curl_setopt($этом->скручиваемость, CURLOPT_POST, ложь);
curl_setopt($этом->скручиваемость, CURLOPT_RETURNTRANSFER, True);в

$contactsresponse = curl_exec($этом->завиток);
curl_close($этом->завиток);

//Загрузка XML-ответ
$contactsxml = simplexml_load_string($contactsresponse);
$данных = [];
по каждому элементу ($contactsxml->запись как $вход) {
 $имя = $запись->название;
$ГД = $запись->дети('http://schemas.google.com/g/2005');
по каждому элементу ($ГД->телефона, как $п) {
если ($с->атрибуты()->атрибут rel == 'http://schemas.google.com/g/2005#mobile') {
$п = трим(код preg_replace("/[\д+]*/", ", $р));
если (подстрока((строка) $н, 0, 1) !== '0' && функция strlen($н) > 10) {
$данных[] = ['имя' => "$имя ($н)", 'идентификатор' => $н];
}
}
}
}
usort($данных [$, у sortByName']);

возврат $данных;
}

 общественные функции sortByName($А $Б)
{
возвращение strcasecmp($а['имя'], $б['имя']);
}
}

/*
* Начало сессии, поэтому мы не всегда должны
* войдите в систему.
*/
если (!использования isset($_SESSION)) {
$cookieParams = session_get_cookie_params(); // возвращает текущие параметры cookie-файлов.
session_set_cookie_params($cookieParams['жизнь'], $cookieParams['путь'], $cookieParams['домен'], false или True);
session_name('wa_session'); // задает имя сессии один набор выше.
если же нет(); // запустить PHP сессии
}

/*
* Определить, как скрипт называется. Если он был тоже выложила, мы
 * что делать, если его просто позвали через вам, мы, вероятно,
* нужно только показать страницу входа.
*/
$в whatsapp = новое приложение whatsapp($конфиг);

если (в$_server['методы'] !== 'Пост') {
если (использования isset($_SESSION['logged_in']) && $_SESSION['logged_in'] !== значение True) {
выход($в whatsapp->showWebLoginForm());
}
}
$в whatsapp->процесс();

класс в whatsapp
{
Частная $конфиг;
Частная долларов;
Частная $номер;
Частная $ИД;
Частная $ник;
Частная $пароль;
Частная $контакты = [];
Частная $входов;
Частная $сообщения;
Частная $ва;
Частная $подключен;
 Частная $waGroupList;

общественная функция __конструкт(массив $config файл)
{
$этом->конфигурация = $config;в

если (в$_server['методы'] == 'пост') {
попробовать {
$этом->входы = $этом->cleanPostInputs();

если (использования isset($этом->входы['с'])) {
$этом->с = $этом->входы['с'];

если (!array_key_exists($этом->от, $этом->конфиг)) {
выход(json_encode([
'успех' => false,то
"Тип" контакты=>'',
 'errormsg' => "параметры конфигурации для пользователя $этом->с может быть найден",
]));
} еще {
$этом->число = $этом->конфиг[$этом->с]['fromNumber'];
$этом->идентификатор = $этом->конфиг[$этом->с]['идентификатор'];
